"use strict";let __rslib_import_meta_url__="undefined"==typeof document?new(require("url".replace("",""))).URL("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("main.js",document.baseURI).href;var __webpack_require__={};__webpack_require__.d=function(e,t){for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Json2Excel});let is_toString=Object.prototype.toString;function is(e,t){return is_toString.call(e)===`[object ${t}]`}function isDef(e){return void 0!==e}function isUnDef(e){return!isDef(e)}function isObject(e){return null!==e&&is(e,"Object")}function isEmpty(e){return isArray(e)||isString(e)?0===e.length:e instanceof Map||e instanceof Set?0===e.size:!!isObject(e)&&0===Object.keys(e).length}function isDate(e){return is(e,"Date")}function isNull(e){return null===e}function isNullAndUnDef(e){return isUnDef(e)&&isNull(e)}function isNullOrUnDef(e){return isUnDef(e)||isNull(e)}function isNumber(e){return is(e,"Number")}function isPromise(e){return is(e,"Promise")&&isObject(e)&&isFunction(e.then)&&isFunction(e.catch)}function isString(e){return is(e,"String")}function isFunction(e){return"function"==typeof e}function isBoolean(e){return is(e,"Boolean")}function isRegExp(e){return is(e,"RegExp")}function isArray(e){return e&&Array.isArray(e)}function isWindow(e){return"undefined"!=typeof window&&is(e,"Window")}function isElement(e){return isObject(e)&&!!e.tagName}function isMap(e){return is(e,"Map")}let isServer=null,isClient=null;function isUrl(e){return/(((^https?:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+(?::\d+)?|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)$/.test(e)}function isValidMap(e){return isArray(e)||isObject(e)}function isJsonStr(e){if(isString(e))try{let t=JSON.parse(e);if(t&&isObject(t))return!0;return!1}catch(t){return console.log("errorï¼š"+e+"!!!"+t),!1}}class Json2Excel{data;scope;orderedKey;filters;title;footer;keyMap;name;type;onStart;onSuccess;onError;constructor({data:e=[],scope:t={},orderedKey:r=[],filters:n=[],title:o=[],footer:i=[],keyMap:s={},name:l="excel",type:a="xls",onStart:c=()=>{},onSuccess:h=()=>{},onError:u=e=>{console.log(e)}}){this.data=e,this.scope=t,this.filters=n,this.footer=i,this.orderedKey=r,this.keyMap=s,this.name=l,this.title=o,this.type=a,this.onStart=c,this.onSuccess=h,this.onError=u}generate(){if(!this.data||!this.data.length){this.onError&&this.onError();return}this.onStart&&this.onStart();let e=this.getProcessedJson(this.data);return(e=this.toChsKeys(e),"csv"==this.type)?this.export(this.jsonToCSV(e),`${this.name}.${this.type}`,"application/csv"):this.export(this.jsonToXLS(e),`${this.name}.${this.type}`,"application/vnd.ms-excel")}getObjLastValue(e,t){if(isObject(t)){let r=Object.keys(t)[0],n=Object.values(t)[0];return this.getObjLastValue(e[r],n)}return e[t]}toChsKeys(e){return e.map(e=>{let t={};if(this.orderedKey&&this.orderedKey.length)for(let r of this.orderedKey)t[r]=e[r];if(this.filters&&this.filters.length)for(let e of this.filters)delete t[e];if(this.scope&&Object.keys(this.scope).length){let r=Object.keys(t).length?t:e;for(let e in r)this.scope.hasOwnProperty(e)?t[e]=this.getObjLastValue(r[e],this.scope[e]):t[e]=r[e]}if(this.keyMap&&Object.keys(this.keyMap).length){let r=Object.keys(t).length?t:e;for(let e in r)this.keyMap.hasOwnProperty(e)&&(t[this.keyMap[e]]=r[e],delete r[e])}return Object.keys(t).length?t:e})}download(e,t){if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(e,t);else{let r=document.createElement("a"),n=window.URL.createObjectURL(e);r.href=n,r.setAttribute("download",t),r.innerHTML="downloading...",r.style.display="none",document.body.appendChild(r),setTimeout(()=>{r.click(),document.body.removeChild(r),setTimeout(()=>{self.URL.revokeObjectURL(r.href)},250)},66)}}export(e,t,r){new Promise(n=>{let o=this.base64ToBlob(e,r);n(this.download(o,t))}).then(()=>{this.onSuccess&&this.onSuccess()}).catch(e=>{this.onError&&this.onError(e)})}jsonToXLS(e){let t="<thead><tr>";if(this.title&&this.title.length){for(let e of this.title)t+=`<th colspan=${e.colspan}>${e.name}`;t+="<th></tr>"}for(let r in e[0])t+="<th>"+r+"</th>";if(t+="</tr></thead><tbody>",e.map(e=>{for(let r in t+="<tbody><tr>",e)t+=`<td>${e[r]}</td>`;t+="</tr></tbody>"}),this.footer&&this.footer.length){for(let e of(t+="<tfooter><tr>",this.footer))t+=`<th colspan=${e.colspan}>${e.name}`;t+="<th></tr></tr></tfooter>"}return'<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style type="text/css">td{mso-number-format:@;}</style></head><body><table>${table}</table></body></html>'.replace("${table}",t)}jsonToCSV(e){var t="";if(this.title&&this.title.length){for(let e of this.title)t+=`${e.name}`;t+="\r\n"}for(let r in e[0])t+=r+",";if(t=t.slice(0,t.length-1)+"\r\n",e.map(e=>{for(let r in e){let n=e[r]+"";n.match(/[,"\n]/)&&(n='"'+n.replace(/\"/g,'""')+'"'),t+=n+","}t=t.slice(0,t.length-1)+"\r\n"}),this.footer&&this.footer.length){for(let e of this.footer)t+=`${e.name}`;t+="\r\n"}return t}getProcessedJson(e){let t=this.getKeys(e),r=[];return e.map(e=>{let n={};for(let r in t){let o=t[r];n[r]=this.getNestedData(o,e)}r.push(n)}),r}getKeys(e){let t={};for(let r in e[0])t[r]=r;return t}getNestedData(e,t){let r=isObject(e)?e.field:e,n=null,o=`${r}`.split(".");n=t[o[0]];for(let e=1;e<o.length;e++)n=n[o[e]];return isNullOrUnDef(n=this.callItemCallback(e,n))?"":n}callItemCallback(e,t){return isObject(e)&&isFunction(e.callback)?e.callback(t):t}base64ToBlob(e,t){let r=window.btoa(window.unescape(encodeURIComponent(e))),n=window.atob(r),o=n.length,i=new Uint8ClampedArray(o);for(;o--;)i[o]=n.charCodeAt(o);return new Blob([i],{type:t})}}var __webpack_export_target__=exports;for(var __webpack_i__ in __webpack_exports__)__webpack_export_target__[__webpack_i__]=__webpack_exports__[__webpack_i__];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0});